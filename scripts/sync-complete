#!/bin/bash
# Basic sync script to trigger synchronization of important directories

echo "Starting synchronization..."

# Determine if rsync is available
if command -v rsync &> /dev/null; then
    SYNC_CMD="rsync -avz --progress"
else
    echo "rsync not found, using cp instead"
    SYNC_CMD="cp -r"
fi

# Sync AI workspace
if [ -d "$HOME/storage/shared/Documents/AI-Workspace" ]; then
    echo "Syncing AI-Workspace..."
    if [ "$SYNC_CMD" = "rsync -avz --progress" ]; then
        $SYNC_CMD "$HOME/termux-ai-workspace/" "$HOME/storage/shared/Documents/AI-Workspace/"
    else
        # For cp, remove contents first then copy
        rm -rf "$HOME/storage/shared/Documents/AI-Workspace/"*
        $SYNC_CMD "$HOME/termux-ai-workspace/"* "$HOME/storage/shared/Documents/AI-Workspace/" 2>/dev/null
    fi
else
    echo "AI-Workspace directory not found, creating..."
    mkdir -p "$HOME/storage/shared/Documents/AI-Workspace"
fi

# Sync Obsidian vault
if [ -d "$HOME/storage/shared/Documents/ObsidianVault" ]; then
    echo "Syncing ObsidianVault..."
    if [ "$SYNC_CMD" = "rsync -avz --progress" ]; then
        $SYNC_CMD "$HOME/vault/" "$HOME/storage/shared/Documents/ObsidianVault/" 2>/dev/null || echo "Obsidian vault sync failed or vault directory doesn't exist"
    else
        if [ -d "$HOME/vault" ]; then
            rm -rf "$HOME/storage/shared/Documents/ObsidianVault/"*
            $SYNC_CMD "$HOME/vault/"* "$HOME/storage/shared/Documents/ObsidianVault/" 2>/dev/null || echo "Obsidian vault sync failed or vault directory doesn't exist"
        else
            echo "Obsidian vault directory doesn't exist locally"
        fi
    fi
else
    echo "ObsidianVault directory not found"
fi

echo "Synchronization complete!"