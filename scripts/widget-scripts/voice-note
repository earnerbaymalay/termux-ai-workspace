#!/data/data/com.termux/files/usr/bin/bash
# Voice Note Workflow

# Capture voice input
VOICE_INPUT=$(termux-speech-to-text 2>/dev/null)

if [ -n "$VOICE_INPUT" ]; then
    # Extract text with jq (in case the API returns JSON)
    TEXT=$(echo "$VOICE_INPUT" | jq -r '.text // .' 2>/dev/null || echo "$VOICE_INPUT")
    
    # Create timestamp
    TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')
    
    # Create vault directory if it doesn't exist
    mkdir -p ~/vault
    
    # Append to Quick-Notes.md with timestamp
    echo -e "\n## $TIMESTAMP\n$TEXT\n" >> ~/vault/Quick-Notes.md
    
    # Get AI summary via qwen-chat
    SUMMARY=$(echo "$TEXT" | ~/bin/qwen-chat 2>/dev/null || echo "AI summary not available")
    
    # Show success notification
    termux-toast "Note saved: $TEXT"
else
    termux-toast "No voice input detected"
fi